{"version":3,"sources":["webpack:///./src/views/Auth.vue","webpack:///./src/use/login-form.js","webpack:///./src/views/Auth.vue?eea7"],"names":["for","class","onSubmit","eError","type","id","email","eBlur","pError","password","pBlur","disabled","isSubmitting","isSubmitSpam","useLoginForm","store","useStore","router","useRouter","useForm","handleSubmit","submitCount","PASS_MIN_LEN","SUBMIT_MAX_ATTEMPTS","SUBMIT_TIMEOUT","useField","yup","trim","required","value","errorMessage","handleBlur","min","values","console","log","dispatch","push","computed","watch","val","setTimeout","setup","props","ctx","route","query","message","error","render"],"mappings":"2IAEI,eAAwB,UAApB,mBAAe,G,EAGjB,eAAgC,SAAzBA,IAAI,SAAQ,SAAK,G,YAMxB,eAAoC,SAA7BA,IAAI,YAAW,UAAM,G,mBAWzBC,MAAM,e,gDArBb,eAwBO,QAxBDA,MAAM,OAAQ,SAAM,8CAAU,EAAAC,UAAA,EAAAA,SAAA,qBAAQ,e,CAC1C,EAEA,eAIM,OAJAD,MAAK,yBAA8B,EAAAE,U,CACvC,E,eACA,eAA+D,SAAxDC,KAAK,QAAQC,GAAG,Q,qDAAiB,EAAAC,MAAK,IAAG,OAAI,8BAAE,EAAAC,OAAA,EAAAA,MAAA,sB,mBAAd,EAAAD,SAC3B,EAAAH,Q,iBAAb,eAAyC,yBAAjB,EAAAA,QAAM,I,0BAGhC,eAIM,OAJAF,MAAK,yBAA8B,EAAAO,U,CACvC,E,eACA,eAAwE,SAAjEJ,KAAK,WAAWC,GAAG,W,qDAAoB,EAAAI,SAAQ,IAAG,OAAI,8BAAE,EAAAC,OAAA,EAAAA,MAAA,sB,mBAAjB,EAAAD,YACjC,EAAAD,Q,iBAAb,eAAyC,yBAAjB,EAAAA,QAAM,I,0BAEhC,eAMS,UALPP,MAAM,cACNG,KAAK,SACJO,SAAU,EAAAC,cAAgB,EAAAC,cAC5B,UAED,gBAC+B,EAAAA,c,iBAA/B,eAEM,MAFN,EAA6C,oD,uIChB1C,SAASC,IACd,IAAMC,EAAQC,iBACRC,EAASC,iBAFc,EAIuBC,iBAA5CC,EAJqB,EAIrBA,aAAcR,EAJO,EAIPA,aAAcS,EAJP,EAIOA,YAE9BC,EAAe,EACfC,EAAsB,EACtBC,EAAiB,IARM,EAUqCC,eAChE,QACAC,SAEGC,OACAC,SAAS,0BACTtB,MAAM,0CANIA,EAVc,EAUrBuB,MAA4B1B,EAVP,EAUP2B,aAAkCvB,EAV3B,EAUewB,WAVf,EAmBwCN,eACnE,WACAC,SAEGC,OACAC,SAAS,0BACTI,IACCV,EALJ,uCAMoCA,EANpC,eAFab,EAnBc,EAmBrBoB,MAA+BrB,EAnBV,EAmBJsB,aAAkCpB,EAnB9B,EAmBkBqB,WAYzC7B,EAAWkB,EAAY,yDAAC,WAAOa,GAAP,wFAC5BC,QAAQC,IAAI,OAAQF,GADQ,kBAGpBlB,EAAMqB,SAAS,aAAcH,GAHT,OAI1BhB,EAAOoB,KAAK,KAJc,0GAAD,uDAQvBxB,EAAeyB,gBAAS,kBAAMjB,EAAYQ,OAASN,KAQzD,OANAgB,eAAM1B,GAAc,SAAC2B,GACfA,GACFC,YAAW,kBAAOpB,EAAYQ,MAAQ,IAAIL,MAIvC,CACLlB,QACAG,WACAN,SACAK,SACAD,QACAG,QACAR,WACAU,eACAC,gB,gBD7BW,GACb6B,MADa,SACPC,EAAOC,GACX,IAAMC,EAAQ,iBACR9B,EAAQ,iBASd,OAPG8B,EAAMC,MAAMC,SACbhC,EAAMqB,SAAS,aAAc,CAC3BP,MAAO,OAAAmB,EAAA,MAAMH,EAAMC,MAAMC,SACzB3C,KAAM,YAIV,kBACOU,OE3CX,EAAOmC,OAASA,EAED","file":"js/chunk-2d0be70b.19a25018.js","sourcesContent":["<template>\r\n  <form class=\"card\" @submit.prevent=\"onSubmit\">\r\n    <h1>Войти в систему</h1>\r\n\r\n    <div :class=\"['form-control', { invalid: eError }]\">\r\n      <label for=\"email\">Email</label>\r\n      <input type=\"email\" id=\"email\" v-model=\"email\" @blur=\"eBlur\" />\r\n      <small v-if=\"eError\">{{ eError }}</small>\r\n    </div>\r\n\r\n    <div :class=\"['form-control', { invalid: pError }]\">\r\n      <label for=\"password\">Пароль</label>\r\n      <input type=\"password\" id=\"password\" v-model=\"password\" @blur=\"pBlur\" />\r\n      <small v-if=\"pError\">{{ pError }}</small>\r\n    </div>\r\n    <button\r\n      class=\"btn primary\"\r\n      type=\"submit\"\r\n      :disabled=\"isSubmitting || isSubmitSpam\"\r\n    >\r\n      Войти\r\n    </button>\r\n    <div class=\"text-danger\" v-if=\"isSubmitSpam\">\r\n      Слишком много попыток входа. Попробуйте позже\r\n    </div>\r\n  </form>\r\n</template>\r\n\r\n<script>\r\nimport { useRoute } from \"vue-router\";\r\nimport { useStore } from \"vuex\";\r\nimport {useLoginForm} from \"@/use/login-form\"\r\nimport {error} from \"@/utils/error\"\r\nexport default {\r\n  setup(props, ctx) {\r\n    const route = useRoute();\r\n    const store = useStore();\r\n\r\n    if(route.query.message){\r\n      store.dispatch('setMessage', {\r\n        value: error(route.query.message),\r\n        type: 'warning'\r\n      })\r\n    }\r\n\r\n    return{\r\n        ...useLoginForm()\r\n    }\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped></style>\r\n","import { computed, watch } from \"vue\";\r\nimport { useField, useForm } from \"vee-validate\";\r\nimport * as yup from \"yup\";\r\nimport { useStore } from \"vuex\";\r\nimport { useRouter } from \"vue-router\";\r\n\r\nexport function useLoginForm() {\r\n  const store = useStore();\r\n  const router = useRouter();\r\n\r\n  const { handleSubmit, isSubmitting, submitCount } = useForm();\r\n\r\n  const PASS_MIN_LEN = 6;\r\n  const SUBMIT_MAX_ATTEMPTS = 5;\r\n  const SUBMIT_TIMEOUT = 5000;\r\n\r\n  const { value: email, errorMessage: eError, handleBlur: eBlur } = useField(\r\n    \"email\",\r\n    yup\r\n      .string()\r\n      .trim()\r\n      .required(\"*Это обязательное поле\")\r\n      .email(\"*Пожалуйста, введите корректный email\")\r\n  );\r\n\r\n  const { value: password, errorMessage: pError, handleBlur: pBlur } = useField(\r\n    \"password\",\r\n    yup\r\n      .string()\r\n      .trim()\r\n      .required(\"*Это обязательное поле\")\r\n      .min(\r\n        PASS_MIN_LEN,\r\n        `*Пароль должен быть некороче ${PASS_MIN_LEN} символов`\r\n      )\r\n  );\r\n\r\n  const onSubmit = handleSubmit(async (values) => {\r\n    console.log(\"Form\", values);\r\n    try {\r\n      await store.dispatch(\"auth/login\", values);\r\n      router.push(\"/\");\r\n    } catch (e) {}\r\n  });\r\n\r\n  const isSubmitSpam = computed(() => submitCount.value >= SUBMIT_MAX_ATTEMPTS);\r\n\r\n  watch(isSubmitSpam, (val) => {\r\n    if (val) {\r\n      setTimeout(() => (submitCount.value = 0), SUBMIT_TIMEOUT);\r\n    }\r\n  });\r\n\r\n  return {\r\n    email,\r\n    password,\r\n    eError,\r\n    pError,\r\n    eBlur,\r\n    pBlur,\r\n    onSubmit,\r\n    isSubmitting,\r\n    isSubmitSpam,\r\n  };\r\n}\r\n","import { render } from \"./Auth.vue?vue&type=template&id=a2b0ea0c\"\nimport script from \"./Auth.vue?vue&type=script&lang=js\"\nexport * from \"./Auth.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script"],"sourceRoot":""}